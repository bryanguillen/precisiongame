<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
    <title>Precision Video Game</title>
    <style>
    	* { padding: 0; margin: 0; }
    	canvas { background: #eee; display: block; margin: 0 auto; }
    </style>
</head>
<body>
	<canvas id="myCanvas" width="500" height="350" style="border: 1px solid red;"></canvas>
	<script>
		var canvas = document.getElementById("myCanvas");
		var ctx = canvas.getContext("2d");
		var width = canvas.width;
		var height = canvas.height;
		var startX = width/2;
		var startY = height/2;
		var x = width/2;
		var y = height-15;
		var dx = 1;
		var dy;  
		var rightPressed = false;
		var leftPressed = false;
		var shotFired = false; 
		var ballRadius = 5;
		var gunAngle = 0; 
		var slopeArray = [];
		var angleArray = [];

		document.addEventListener("keydown", keydownHandler, false);
		document.addEventListener("keyup", keyupHandler, false);

		function keydownHandler(e){
			if(e.keyCode == 39){
				rightPressed = true;
			}else if(e.keyCode == 37){
				leftPressed = true;
			}else if(e.keyCode == 32){
				shotFired = true;
			}
		}

		function keyupHandler(e){
			if(e.keyCode == 39){
				rightPressed = false;
			}else if(e.keyCode == 37){
				leftPressed = false;
			}else if(e.keyCode == 32){
				shotFired = false;
			}
		}
		
		//generic functions for accomplishing certain tasks
		/*rise gives the rise for the rise/run which is equal to slope
		automatically, the run is going to be one for the ratio.Next 
		this shoud be the y/x that will give the line! However, take
		note this floors to the nearest whole number, so it will not 
		be optimal at first.*/
		function isPositive(arg){
			if(arg > 0){
				return true;
			} 
			else {
				return false;
			}
		}

		function thirdAngle(theta){
			var thirdAngle = 180 - (90 + Math.abs(theta));
			return thirdAngle;
		}

		function slope(theta){
			var thirdAngleInDegrees = thirdAngle(theta);
			var heightY = (-30*Math.sin(theta*Math.PI/180))/Math.sin(90*Math.PI/180); 
			var widthX = (-30*Math.sin(thirdAngleInDegrees*Math.PI/180))/Math.sin(90*Math.PI/180);
			var slope = heightY/widthX;
			if(isPositive(slope)){
				slope = -1*slope;
			}
			return slope;
		}

		function stopInterval(){
			clearInterval(drawBallInMotion);
		}

		//startVector allows the user to see trajectory before shot
		function startVector(angle){
			ctx.clearRect(0, 0, width, height);
			//save the prior context
			ctx.save();
			
			ctx.beginPath();
			
			//[0,0] is now at [250,350], lower center of canvas
			ctx.translate(250,350);
			ctx.rotate(gunAngle*Math.PI/180);
			ctx.moveTo(0,0);
			ctx.lineTo(0,-30);
			ctx.stroke();
			
			//bring back the normalized context plane.
			ctx.restore();
		}

		function drawBall(){
			ctx.beginPath();
			ctx.arc(x, y, ballRadius, 0, Math.PI*2, false);
			ctx.fillStyle = "black";
			ctx.fill();
			ctx.closePath();
		}

		function drawBallInMotion(){
			ctx.clearRect(0, 0, width, height);	
			//TODO add instruction here;
			drawBall();
			
			x += dx;
		

			if(x + dx > width-ballRadius || x + dx < ballRadius){
				dx = -dx;
			}
			
			if(y + dy < ballRadius){
				dy = -dy;
			} else if(y + dy > height+ballRadius){	
					stopInterval();
					document.location.reload();
			}	
		}

		function draw(){
			//for not leaving a trail behind after every frame
			ctx.clearRect(0, 0, width, height);
			startVector(gunAngle);
			
			if(rightPressed && gunAngle < 80){
				gunAngle += 2;
			}
			if(leftPressed && gunAngle > -80){
				gunAngle -= 2;
			}	
			if(shotFired){
				clearInterval(gamePlay);
				if(isPositive(gunAngle)){
					gunAngle = 90 - gunAngle;
				}
				else{
					gunAngle = -90 - gunAngle;
				}
				angleArray.push(gunAngle);
				slope = slope(gunAngle);
				slopeArray.push(slope);
				console.log(slopeArray);
			}
		}
		var gamePlay = setInterval(draw, 10);
	</script>
</body>
</html>